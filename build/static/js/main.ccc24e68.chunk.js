(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{167:function(e,t,n){e.exports=n(342)},172:function(e,t,n){},324:function(e,t,n){},342:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(6),s=n.n(r),i=(n(172),n(54)),l=n(55),u=n(60),c=n(61);function d(){return o.a.createElement("div",{className:"app-header"},o.a.createElement("h1",null,"\u4e00\u58f6\u79d1\u6280\u5fb7\u5dde\u5927\u8d5b\u6392\u884c\u699c"))}var f=n(343),h=o.a.createContext({users:[],rounds:[],roundUserInfo:[],setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){}});function m(e){var t=e.list,n=Object(a.useContext)(h),r=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max"},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min"},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total"},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance"},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return o.a.createElement("div",null,o.a.createElement(f.a,{dataSource:t,columns:r}))}n(324),n(325);var v=n(20),p=n.n(v),g=n(18),y=n(344),k=n(346),I=n(345),b=n(35),C=n.n(b),x=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={loading:!1,list:[{roundNO:1}],dateTime:"",leverage:.1,userAmount:{}},e.handleOk=function(){var t=e.state,n=t.dateTime,a=t.leverage,o=t.userAmount;if(e.props.isModify){var r=e.props.roundIndex,s=e.context.rounds[r],i=e.context.roundUserInfo[r],l=p.a.Object.createWithoutData("Round",s.get("objectId"));l.set("dateTime",n),l.set("leverage",a);var u=[];Object.keys(o).forEach((function(t){var n,a=i.find((function(e){return e.get("player").get("objectId")===t}));if(a)n=a;else{var r=e.context.users.find((function(e){return e.get("objectId")===t}));(n=new(p.a.Object.extend("RoundUserInfo"))).set("round",l),n.set("player",r)}n.set("amount",o[t]),u.push(n)})),Promise.all([l.save(),p.a.Object.saveAll(u)]).then((function(){e.props.onOk&&e.props.onOk()}))}else{var c=new(p.a.Object.extend("Round"));c.set("dateTime",n),c.set("leverage",a);var d=p.a.Object.extend("RoundUserInfo"),f=[];Object.keys(o).forEach((function(t){var n=new d,a=e.context.users.find((function(e){return e.get("objectId")===t}));n.set("round",c),n.set("player",a),n.set("amount",o[t]),f.push(n)})),p.a.Object.saveAll(f).then((function(){e.props.onOk&&e.props.onOk()}))}},e.handleDateTimeChange=function(t){e.setState({dateTime:t.format("YYYY/MM/DD")})},e.handleLeverageChange=function(t){e.setState({leverage:t})},e.handleAmountChange=function(t,n){var a=e.state.userAmount;a[n.get("objectId")]=+t,e.setState({userAmount:a})},e.handleCancel=function(){e.setState({loading:!1,list:[{roundNO:1}],dateTime:"",leverage:.1,userAmount:{}}),e.props.onCancel()},e}return Object(l.a)(n,[{key:"getTableColumns",value:function(){var e=this,t=[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return o.a.createElement("div",{style:{width:"150px"}},o.a.createElement(y.a,{onChange:e.handleDateTimeChange,format:"YYYY/MM/DD",value:C()(e.state.dateTime,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return o.a.createElement(k.a,{onChange:e.handleLeverageChange,value:e.state.leverage})}}],n=this.context.users;return t.concat(n.map((function(t){return{title:t.get("name"),key:t.get("objectId"),ellipsis:!0,render:function(n,a){return o.a.createElement(k.a,{onChange:function(n){return e.handleAmountChange(n,t)},value:e.state.userAmount[t.get("objectId")]})}}})))}},{key:"calcState",value:function(){var e=this.context.rounds,t=this.props,n=t.isModify,a=t.roundIndex;if(n){var o=this.context.roundUserInfo[a],r=e[a],s={};o&&o.forEach((function(e){s[e.get("player").get("objectId")]=e.get("amount")})),this.setState({list:[{roundNO:a+1}],userAmount:s,leverage:r.get("leverage"),dateTime:r.get("dateTime")})}else this.setState({list:[{roundNO:e.length+1}]})}},{key:"componentDidUpdate",value:function(e){!e.visible&&this.props.visible&&this.calcState()}},{key:"render",value:function(){return o.a.createElement(I.a,{visible:this.props.visible,onCancel:this.handleCancel,onOk:this.handleOk,confirmLoading:this.state.loading,width:1200,destroyOnClose:!0},o.a.createElement("div",{className:"add-round-wrap"},o.a.createElement(f.a,{dataSource:this.state.list,columns:this.getTableColumns(),pagination:!1,scroll:{x:!0}})))}}]),n}(a.Component);x.contextType=h;var O=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).handleModifyClick=function(t){e.props.onModify(t)},e.getUserRoundInfo=function(t,n){var a=e.context.roundUserInfo[n];if(a){var o=a.find((function(e){return e.get("player").get("objectId")===t}));return o&&o.get("amount")||""}return""},e}return Object(l.a)(n,[{key:"getTableColumns",value:function(){var e=this,t=this.context.users;return[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}].concat(t.map((function(t){return{title:t.get("name"),key:t.get("objectId"),ellipsis:!0,render:function(n,a,o){return e.getUserRoundInfo(t.get("objectId"),o)}}})),{title:"\u64cd\u4f5c",key:"opt",render:function(t,n,a){return o.a.createElement("div",{className:"details-opt"},o.a.createElement("span",{onClick:function(){return e.handleModifyClick(a)}},"\u4fee\u6539"))}})}},{key:"render",value:function(){var e=this.context.rounds;return o.a.createElement(I.a,{visible:this.props.visible,onCancel:this.props.onCancel,onOk:this.props.onOk,width:1200},o.a.createElement("div",{className:"details-round-wrap"},o.a.createElement(f.a,{dataSource:e,columns:this.getTableColumns(),pagination:!1,scroll:{x:!0}})))}}]),n}(a.Component);O.contextType=h;var w=n(162),M=n.n(w),j=n(91),E=n.n(j),U=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={users:[],rounds:[],roundUserInfo:[],setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,list:[],showModal:!1,addLoading:!1,showDetailsModal:!1,modifyIndex:-1,isModify:!1},e.getUsers=function(){new p.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.setUsers=function(t){e.setState({users:t})},e.getAllRounds=function(){new p.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.setRounds=function(t){e.setState({rounds:t})},e.getRoundInfo=function(e){var t=new p.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.handleAddClick=function(){e.setState({showModal:!0,isModify:!1})},e.handleDetailsClick=function(){e.setState({showDetailsModal:!0})},e.handleModalCancel=function(){e.setState({showModal:!1})},e.handleModalConfirm=function(){e.setState({showModal:!1}),e.getAllRounds()},e.handleDetailsConfirm=function(){e.setState({showDetailsModal:!1})},e.handleDetailsCancel=function(){e.setState({showDetailsModal:!1})},e.handleModify=function(t){e.setState({modifyIndex:t,isModify:!0,showDetailsModal:!1,showModal:!0})},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={},o=n[n.length-1],r=0;o&&(r=o.get("leverage")),t.forEach((function(e,t){var o=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var s=t.get("objectId"),i=a[s];i||(i={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:r}),n>i.max&&(i.max=n),n<i.min&&(i.min=n),i.total=new E.a(i.total).plus(n).valueOf(),i.totalBalance=new E.a(i.totalBalance).plus(new E.a(n).times(o)).valueOf(),0!==n&&i.count++,a[s]=i}))}));var s=M.a.values(a);s.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:s})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,r=e.setUsers,s=e.setRounds,i=e.setRoundUserInfo,l=e.list;return o.a.createElement("div",{className:"App"},o.a.createElement(h.Provider,{value:{users:t,rounds:n,roundUserInfo:a,setUsers:r,setRounds:s,setRoundUserInfo:i}},o.a.createElement(d,null),o.a.createElement(m,{list:l}),o.a.createElement("div",{className:"btn-wrap"},o.a.createElement(g.a,{type:"primary",onClick:this.handleDetailsClick},"\u660e\u7ec6"),o.a.createElement(g.a,{type:"primary",onClick:this.handleAddClick},"\u589e\u52a0\u8bb0\u5f55")),o.a.createElement(x,{visible:this.state.showModal,onOk:this.handleModalConfirm,onCancel:this.handleModalCancel,isModify:this.state.isModify,roundIndex:this.state.modifyIndex}),o.a.createElement(O,{visible:this.state.showDetailsModal,onOk:this.handleDetailsConfirm,onCancel:this.handleDetailsCancel,onModify:this.handleModify})))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));p.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[167,1,2]]]);
//# sourceMappingURL=main.ccc24e68.chunk.js.map