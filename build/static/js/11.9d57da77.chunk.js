(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[11],{477:function(e,t,a){},606:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return p}));var s=a(39),n=a(66),i=a(156),r=a(95),c=a(0),l=a.n(c),o=a(460),m=a(427),u=a(40),g=a(19),h=a.n(g),d=a(476),f=a(446),v=a.n(f),p=(a(477),function(e){Object(r.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={text:"",messageList:[],isJoining:!1},e.client=null,e.room=null,e.scrollRef=Object(c.createRef)(),e.user=h.a.User.current(),e.handleTextMessageChange=function(t){e.setState({text:t.target.value})},e.handleTextMessageEnterChange=function(t){e.setState({text:t.currentTarget.value}),e.handleSend()},e.handleSend=function(){if(e.state.text){var t=new d.TextMessage(e.state.text);t.setAttributes({senderName:e.user.getUsername()}),e.room&&(e.room.send(t),e.updateMessageList(t),e.setState({text:""}))}},e}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.user&&new d.Realtime({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",server:"https://xfklg0d6.lc-cn-n1-shared.com"}).createIMClient(this.user).then((function(t){e.client=t,t.getQuery().equalTo("tr",!0).find().then((function(t){t.length<1?e.createRoom():e.joinRoom(t[0])})).then((function(){e.listenMessage()})).catch(console.error)}))}},{key:"createRoom",value:function(){var e=this;this.client&&this.client.createChatRoom({name:"\u6df1\u6316\u6d1e\uff0c\u5e7f\u79ef\u7cae\uff0c\u4e0d\u79f0\u738b"}).then((function(t){e.room=t,e.setState({isJoining:!1}),e.loadLocalMessages()}))}},{key:"loadLocalMessages",value:function(){var e=localStorage.getItem("texasMessages");e&&(e=JSON.parse(e),this.setState({messageList:e}))}},{key:"joinRoom",value:function(e){var t=this;e.join().then((function(){t.room=e,t.setState({isJoining:!1}),t.loadLocalMessages()}))}},{key:"listenMessage",value:function(){var e=this;this.client&&(this.client.on(d.Event.INVITED,(function(e,t){})),this.client.on(d.Event.MESSAGE,(function(t,a){e.updateMessageList(t)})))}},{key:"updateMessageList",value:function(e){var t=this;this.setState({messageList:this.state.messageList.concat(e)},(function(){localStorage.setItem("texasMessages",JSON.stringify(t.state.messageList.slice(0,100)))})),setTimeout((function(){var e=t.scrollRef.current;e&&e.scrollTo(0,e.scrollHeight)}),100)}},{key:"getSenderName",value:function(e){return e.attributes.senderName}},{key:"render",value:function(){var e=this;return this.user?this.state.isJoining?l.a.createElement("div",{className:"message-wrap"},l.a.createElement(o.a,{tip:"\u6b63\u5728\u52a0\u5165\u804a\u5929\u5ba4..."})):l.a.createElement("div",{className:"message-wrap"},l.a.createElement("div",{className:"messages",ref:this.scrollRef},this.state.messageList.map((function(t){return l.a.createElement("div",{className:"message-item",key:t.id},l.a.createElement("div",null,l.a.createElement("span",{className:"username"},e.getSenderName(t)),l.a.createElement("span",{className:"message-time"},v()(t.timestamp).format("YYYY/MM/DD HH:mm:ss"))),l.a.createElement("div",{className:"message-content"},t.text))}))),l.a.createElement("div",{className:"send-wrap"},l.a.createElement(m.a,{value:this.state.text,onChange:this.handleTextMessageChange,onPressEnter:this.handleTextMessageEnterChange}),l.a.createElement(u.a,{size:"large",onClick:this.handleSend},"\u53d1\u9001"))):l.a.createElement("div",{className:"message-wrap"},l.a.createElement("div",null,"\u8bf7\u5148\u767b\u5f55"))}}]),a}(c.Component))}}]);
//# sourceMappingURL=11.9d57da77.chunk.js.map