(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{178:function(e,t,n){e.exports=n(365)},183:function(e,t,n){},335:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},365:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(5),s=n.n(r),i=(n(183),n(141)),l=n(142),c=n(175),u=n(176);function d(){return o.a.createElement("div",{className:"app-header"},o.a.createElement("h1",null,"\u4e00\u58f6\u79d1\u6280\u5fb7\u5dde\u5927\u8d5b\u6392\u884c\u699c"))}var f=n(366),m=o.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){}});function h(e){var t=e.list,n=Object(a.useContext)(m),r=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max"},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min"},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total"},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance"},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return o.a.createElement("div",null,o.a.createElement(f.a,{dataSource:t,columns:r}))}n(335),n(336);var v=n(11),g=n.n(v),b=n(17),p=n(156),y=n(32),w=n(367),O=n(370),I=n(368),j=n(39),S=n.n(j);function k(e){var t=e.isModify,n=void 0!==t&&t,r=e.roundIndex,s=void 0===r?0:r,i=e.visible,l=e.onOk,c=e.onCancel,u=Object(a.useContext)(m),d=u.rounds,h=u.roundUserInfo,v=Object(a.useState)([{roundNO:d.length+1}]),b=Object(y.a)(v,2),j=b[0],k=b[1],E=Object(a.useState)(""),C=Object(y.a)(E,2),M=C[0],U=C[1],x=Object(a.useState)(.1),R=Object(y.a)(x,2),D=R[0],N=R[1],Y=Object(a.useState)({}),T=Object(y.a)(Y,2),B=T[0],A=T[1];function L(e){U(e?e.format("YYYY/MM/DD"):"")}function P(e){N(e||.1)}return Object(a.useEffect)((function(){if(n){var e=h[s],t=d[s],a={};e&&e.forEach((function(e){a[e.get("player").get("objectId")]=e.get("amount")})),k([{roundNO:s+1}]),N(t.get("leverage")),U(t.get("dateTime")),A(a)}}),[n,h,s,d]),o.a.createElement(I.a,{visible:i,onCancel:function(){c()},onOk:function(){if(n){var e=u.rounds[s],t=u.roundUserInfo[s],a=g.a.Object.createWithoutData("Round",e.get("objectId"));a.set("dateTime",M),a.set("leverage",D);var o=[];Object.keys(B).forEach((function(e){var n,r=t.find((function(t){return t.get("player").get("objectId")===e}));if(r)n=r;else{var s=u.users.find((function(t){return t.get("objectId")===e}));(n=new(g.a.Object.extend("RoundUserInfo"))).set("round",a),n.set("player",s)}n.set("amount",B[e]),o.push(n)})),Promise.all([a.save(),g.a.Object.saveAll(o)]).then((function(){l&&l()}))}else{var r=new(g.a.Object.extend("Round"));r.set("dateTime",M),r.set("leverage",D);var i=g.a.Object.extend("RoundUserInfo"),c=[];Object.keys(B).forEach((function(e){var t=new i,n=u.users.find((function(t){return t.get("objectId")===e}));t.set("round",r),t.set("player",n),t.set("amount",B[e]),c.push(t)})),g.a.Object.saveAll(c).then((function(){l&&l()}))}},width:1200},o.a.createElement("div",{className:"add-round-wrap"},o.a.createElement(f.a,{dataSource:j,columns:[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return o.a.createElement("div",{style:{width:"150px"}},o.a.createElement(w.a,{onChange:L,format:"YYYY/MM/DD",value:S()(M,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return o.a.createElement(O.a,{onChange:P,value:D})}}].concat(u.users.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(){return o.a.createElement(O.a,{onChange:function(t){return function(e,t){e=e?+e:0;var n=Object(p.a)({},B);n[t.get("objectId")]=e,A(n)}(t,e)},value:B[e.get("objectId")]})}}}))),pagination:!1,scroll:{x:!0}})))}function E(e){var t=e.visible,n=e.onModify,r=e.onOk,s=e.onCancel,i=Object(a.useContext)(m);var l=i.rounds;return o.a.createElement(I.a,{visible:t,onCancel:s,onOk:r,width:1200},o.a.createElement("div",{className:"details-round-wrap"},o.a.createElement(f.a,{dataSource:l,columns:function(){var e=[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}],t=i.users;return e=e.concat(t.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(t,n,a){return function(e,t){var n=i.roundUserInfo[t];if(n){var a=n.find((function(t){return t.get("player").get("objectId")===e}));return a&&a.get("amount")||""}return""}(e.get("objectId"),a)}}}))),g.a.User.current()&&(e=e.concat({title:"\u64cd\u4f5c",key:"opt",render:function(e,t,a){return o.a.createElement("div",{className:"details-opt"},o.a.createElement("span",{onClick:function(){return function(e){n(e)}(a)}},"\u4fee\u6539"))}})),e}(),pagination:!1,scroll:{x:!0}})))}var C=n(166),M=n.n(C),U=n(93),x=n.n(U),R=(n(353),n(371)),D=n(369);n(354);function N(e){var t=e.visible,n=Object(a.useState)(!1),r=Object(y.a)(n,2),s=r[0],i=r[1],l=Object(a.useState)(""),c=Object(y.a)(l,2),u=c[0],d=c[1],f=Object(a.useState)(""),h=Object(y.a)(f,2),v=h[0],p=h[1],w=Object(a.useState)(0),O=Object(y.a)(w,2),j=O[0],S=O[1],k=Object(a.useContext)(m);function E(){j<=0||(S(j-1),setTimeout(E,1e3))}return o.a.createElement(I.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return u?v?(i(!0),void g.a.User.signUpOrlogInWithMobilePhone("+86".concat(u),v).then((function(e){i(!1),k.setShowSession(!1)}),(function(e){i(!1),R.a.error(e.message)}))):R.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):R.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){k.setShowSession(!1)},confirmLoading:s},o.a.createElement("div",{className:"session"},o.a.createElement("div",{className:"form-row"},o.a.createElement(D.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:u,onChange:function(e){d(e.target.value)}})),o.a.createElement("div",{className:"form-row"},o.a.createElement(D.a,{placeholder:"\u9a8c\u8bc1\u7801",value:v,onChange:function(e){p(e.target.value)}}),o.a.createElement(b.a,{disabled:j>0,onClick:function(){j>0||!u||g.a.Cloud.requestSmsCode("+86".concat(u)).then((function(){S(60),function(){if(j>0)return;E()}()}))}},j<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(j,"s")))))}function Y(){var e=Object(a.useContext)(m);var t=g.a.User.current();return o.a.createElement("div",{className:"top-bar"},t?o.a.createElement("span",null,t.getUsername()):o.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),o.a.createElement(N,{visible:e.showSession}))}var T=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,list:[],showModal:!1,addLoading:!1,showDetailsModal:!1,modifyIndex:-1,isModify:!1},e.getUsers=function(){new g.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new g.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new g.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddClick=function(){e.setState({showModal:!0,isModify:!1})},e.handleDetailsClick=function(){e.setState({showDetailsModal:!0})},e.handleModalCancel=function(){e.setState({showModal:!1})},e.handleModalConfirm=function(){e.setState({showModal:!1}),e.getAllRounds()},e.handleDetailsConfirm=function(){e.setState({showDetailsModal:!1})},e.handleDetailsCancel=function(){e.setState({showDetailsModal:!1})},e.handleModify=function(t){e.setState({modifyIndex:t,isModify:!0,showDetailsModal:!1,showModal:!0})},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={},o=n[n.length-1],r=0;o&&(r=o.get("leverage")),t.forEach((function(e,t){var o=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var s=t.get("objectId"),i=a[s];i||(i={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:r}),n>i.max&&(i.max=n),n<i.min&&(i.min=n),i.total=+new x.a(i.total).plus(n).valueOf(),i.totalBalance=+new x.a(i.totalBalance).plus(new x.a(n).times(o)).valueOf(),0!==n&&i.count++,a[s]=i}))}));var s=M.a.values(a);s.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:s})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,r=e.showSession,s=e.setUsers,i=e.setRounds,l=e.setRoundUserInfo,c=e.setShowSession,u=e.list,f=g.a.User.current();return o.a.createElement("div",{className:"app"},o.a.createElement(m.Provider,{value:{users:t,rounds:n,roundUserInfo:a,showSession:r,setUsers:s,setRounds:i,setRoundUserInfo:l,setShowSession:c}},o.a.createElement(Y,null),o.a.createElement(d,null),o.a.createElement(h,{list:u}),o.a.createElement("div",{className:"btn-wrap"},o.a.createElement(b.a,{type:"primary",onClick:this.handleDetailsClick},"\u660e\u7ec6"),f?o.a.createElement(b.a,{type:"primary",onClick:this.handleAddClick},"\u589e\u52a0\u8bb0\u5f55"):null),o.a.createElement(k,{visible:this.state.showModal,onOk:this.handleModalConfirm,onCancel:this.handleModalCancel,isModify:this.state.isModify,roundIndex:this.state.modifyIndex}),o.a.createElement(E,{visible:this.state.showDetailsModal,onOk:this.handleDetailsConfirm,onCancel:this.handleDetailsCancel,onModify:this.handleModify})))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));g.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[178,1,2]]]);
//# sourceMappingURL=main.4a145a35.chunk.js.map