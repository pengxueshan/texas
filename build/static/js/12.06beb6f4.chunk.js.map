{"version":3,"sources":["../node_modules/@ant-design/icons-svg/es/asn/EditOutlined.js","../node_modules/@ant-design/icons/es/icons/EditOutlined.js","pages/Profile/index.tsx"],"names":["EditOutlined","props","ref","React","AntdIcon","Object","assign","icon","EditOutlinedSvg","displayName","Profile","state","isEdit","relativePlayer","isSaving","handleEditClick","setState","handleRelativePlayer","player","AV","createWithoutData","user","User","current","set","Promise","all","save","then","err","message","error","handlePlayerSelectChange","v","handleUploadAvatar","file","avFile","File","name","metaData","get","req","push","success","catch","p","this","context","users","find","u","defaultSelect","style","width","placeholder","onChange","defaultValue","map","id","Option","value","key","type","onClick","getRelativePlayer","className","avatar","size","src","UserOutlined","beforeUpload","showUploadList","renderPlayer","renderAvatar","Component","contextType","AppContext"],"mappings":"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","file":"static/js/12.06beb6f4.chunk.js","sourcesContent":["// This icon file is generated automatically.\n// tslint:disable\nvar EditOutlined = { \"name\": \"edit\", \"theme\": \"outlined\", \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z\" } }] } };\nexport default EditOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport EditOutlinedSvg from \"@ant-design/icons-svg/es/asn/EditOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar EditOutlined = function EditOutlined(props, ref) {\n  return React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: EditOutlinedSvg\n  }));\n};\n\nEditOutlined.displayName = 'EditOutlined';\nexport default React.forwardRef(EditOutlined);","import React from 'react';\nimport { Select, Button, message, Upload, Avatar } from 'antd';\nimport AV from 'leancloud-storage';\nimport { EditOutlined, UserOutlined } from '@ant-design/icons';\nimport AppContext from '../../store/context';\nimport './profile.scss';\n\ninterface State {\n  isEdit: boolean;\n  relativePlayer: string;\n  isSaving: boolean;\n}\n\nexport default class Profile extends React.Component {\n  static contextType = AppContext;\n\n  state: State = {\n    isEdit: false,\n    relativePlayer: '',\n    isSaving: false,\n  };\n\n  getRelativePlayer() {\n    const user = AV.User.current();\n    let player = user.get('player');\n    if (!player) {\n      return '--';\n    }\n    let p = this.context.users.find(\n      (u: AV.Object) => u.get('objectId') === player.get('objectId')\n    );\n    return (p && p.get('name')) || '--';\n  }\n\n  handleEditClick = () => {\n    this.setState({\n      isEdit: true,\n    });\n  };\n\n  handleRelativePlayer = () => {\n    if (this.state.isSaving) return;\n    const player = AV.Object.createWithoutData(\n      'Player',\n      this.state.relativePlayer\n    );\n    const user = AV.User.current();\n    player.set('user', user);\n    user.set('player', player);\n    this.setState({\n      isSaving: true,\n    });\n    Promise.all([player.save(), user.save()]).then(\n      () => {\n        this.setState({\n          isEdit: false,\n          isSaving: false,\n        });\n      },\n      (err) => {\n        message.error(err.message);\n        this.setState({\n          isSaving: false,\n        });\n      }\n    );\n  };\n\n  handlePlayerSelectChange = (v: string) => {\n    this.setState({\n      relativePlayer: v,\n    });\n  };\n\n  renderPlayer() {\n    let { users } = this.context;\n    if (this.state.isEdit) {\n      const currentUser = AV.User.current();\n      let defaultSelect = currentUser.get('player');\n      defaultSelect = (defaultSelect && defaultSelect.get('objectId')) || '';\n      return (\n        <>\n          <Select\n            style={{ width: 120 }}\n            placeholder=\"请选择选手\"\n            onChange={this.handlePlayerSelectChange}\n            defaultValue={defaultSelect}\n          >\n            {users.map((player: AV.Object) => {\n              let id = player.get('objectId');\n              return (\n                <Select.Option value={id} key={id}>\n                  {player.get('name')}\n                </Select.Option>\n              );\n            })}\n          </Select>\n          <Button type=\"link\" onClick={this.handleRelativePlayer}>\n            保存\n          </Button>\n          <Button\n            type=\"link\"\n            onClick={() => {\n              this.setState({\n                isEdit: false,\n              });\n            }}\n          >\n            取消\n          </Button>\n          <span>未找到选手？请联系管理员添加</span>\n        </>\n      );\n    } else {\n      return (\n        <>\n          {this.getRelativePlayer()}\n          <div className=\"edit-wrap\" onClick={this.handleEditClick}>\n            <EditOutlined />\n          </div>\n        </>\n      );\n    }\n  }\n\n  handleUploadAvatar = (file: File) => {\n    let avFile = new AV.File(file.name, file);\n    avFile.metaData('type', 1); // 1: avatar\n    const user = AV.User.current();\n    user.set('avatar', avFile);\n    let player;\n    if (user.get('player')) {\n      player = user.get('player').get('objectId');\n      player = AV.Object.createWithoutData('Player', player);\n      player.set('avatar', avFile);\n    }\n    let req: any[] = [user.save()];\n    if (player) {\n      req.push(player.save());\n    }\n    Promise.all(req)\n      .then(() => {\n        message.success('上传成功');\n      })\n      .catch((err) => {\n        message.error(err.message);\n      });\n    return false;\n  };\n\n  renderAvatar() {\n    const user = AV.User.current();\n    const avatar = user.get('avatar');\n    return (\n      <>\n        <div className=\"avatar-wrap\">\n          {avatar ? (\n            <Avatar size={64} src={avatar.get('url')} />\n          ) : (\n            <Avatar size={64} icon={<UserOutlined />} />\n          )}\n        </div>\n        <Upload beforeUpload={this.handleUploadAvatar} showUploadList={false}>\n          <Button>上传</Button>\n        </Upload>\n      </>\n    );\n  }\n\n  render() {\n    return (\n      <div className=\"page profile\">\n        <div className=\"row\">\n          <span className=\"label\">关联选手</span>\n          <div className=\"content\">{this.renderPlayer()}</div>\n        </div>\n        <div className=\"row\">\n          <span className=\"label\">头像</span>\n          <div className=\"content\">{this.renderAvatar()}</div>\n        </div>\n      </div>\n    );\n  }\n}\n"],"sourceRoot":""}