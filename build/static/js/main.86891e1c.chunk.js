(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[4],{240:function(e,t,n){e.exports=n(435)},245:function(e,t,n){},246:function(e,t,n){},247:function(e,t,n){},251:function(e,t){},253:function(e,t){},285:function(e,t){},286:function(e,t){},34:function(e,t,n){"use strict";var a=n(0),o=n.n(a);t.a=o.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){},isAuthenticated:!1,setIsAuthenticated:function(){}})},427:function(e,t,n){},435:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(6),r=n.n(s),c=(n(245),n(40)),l=n(67),u=n(159),i=n(95),d=n(34),f=n(19),m=n.n(f),h=n(223),v=n.n(h),E=n(103),b=n.n(E),S=(n(246),n(31)),O=n(441),p=n(439),g=n(440),w=n(42),U=(n(247),n(160));function j(e){var t=e.visible,n=Object(a.useState)(!1),s=Object(S.a)(n,2),r=s[0],c=s[1],l=Object(a.useState)(""),u=Object(S.a)(l,2),i=u[0],f=u[1],h=Object(a.useState)(""),v=Object(S.a)(h,2),E=v[0],b=v[1],j=Object(a.useState)(0),I=Object(S.a)(j,2),R=I[0],y=I[1],C=Object(a.useRef)(R);C.current=R;var A=Object(a.useState)(""),k=Object(S.a)(A,2),T=k[0],_=k[1],P=Object(a.useContext)(d.a);function D(){C.current<=0||(y(C.current-1),setTimeout(D,1e3))}return o.a.createElement(p.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return i?E?T?"41b9df4a217bb3c10b1c339358111b0d"!==Object(U.MD5)(T).toString()?O.a.error("\u9080\u8bf7\u7801\u9519\u8bef"):(c(!0),void m.a.User.signUpOrlogInWithMobilePhone("+86".concat(i),E).then((function(e){c(!1),P.setShowSession(!1)}),(function(e){c(!1),O.a.error(e.message)}))):O.a.error("\u8bf7\u8f93\u5165\u9080\u8bf7\u7801"):O.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):O.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){P.setShowSession(!1)},confirmLoading:r},o.a.createElement("div",{className:"session"},o.a.createElement("div",{className:"form-row"},o.a.createElement(g.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:i,onChange:function(e){f(e.target.value)}})),o.a.createElement("div",{className:"form-row"},o.a.createElement(g.a,{placeholder:"\u9a8c\u8bc1\u7801",value:E,onChange:function(e){b(e.target.value)}}),o.a.createElement(w.a,{disabled:R>0,onClick:function(){R>0||!i||m.a.Cloud.requestSmsCode("+86".concat(i)).then((function(){y(60),setTimeout(D,1e3)}))}},R<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(R,"s"))),o.a.createElement("div",{className:"form-row"},o.a.createElement(g.a,{placeholder:"\u9080\u8bf7\u7801",value:T,onChange:function(e){_(e.target.value)}}))))}var I=n(438),R=n(45),y=n(442);function C(){var e=Object(a.useContext)(d.a);var t,n=m.a.User.current();n&&(t=n.get("avatar"));return o.a.createElement("div",{className:"top-bar"},o.a.createElement("nav",null,o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement(R.b,{to:"/"},"\u6392\u884c\u699c")),o.a.createElement("li",null,o.a.createElement(R.b,{to:"/photo"},"\u7cbe\u5f69\u77ac\u95f4")),o.a.createElement("li",null,o.a.createElement(R.b,{to:"/message"},"\u804a\u5929\u5ba4")))),o.a.createElement("div",{className:"user-section"},n?[o.a.createElement(R.b,{key:"setting",to:"/profile"},t?o.a.createElement(I.a,{size:32,src:t.get("url")}):o.a.createElement(I.a,{size:32,icon:o.a.createElement(y.a,null)})),o.a.createElement("span",{key:"logout",className:"link-style",onClick:function(){p.a.confirm({title:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:function(){return m.a.User.logOut().then((function(){window.location.href="/"}))}})}},"\u9000\u51fa\u767b\u5f55")]:o.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),o.a.createElement(j,{visible:e.showSession})))}var A=n(8),k=n(46);function T(e){var t=e.children,n=Object(k.a)(e,["children"]),s=Object(a.useContext)(d.a),r=!Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).production;return o.a.createElement(A.b,Object.assign({},n,{render:function(e){var n=e.location;return r||s.isAuthenticated?t:o.a.createElement(A.a,{to:{pathname:"/auth",state:{from:n}}})}}))}var _=n(437),P=(n(427),n(428),Object(a.lazy)((function(){return Promise.all([n.e(3),n.e(13),n.e(10)]).then(n.bind(null,606))}))),D=Object(a.lazy)((function(){return Promise.all([n.e(0),n.e(2),n.e(1),n.e(12)]).then(n.bind(null,614))})),x=Object(a.lazy)((function(){return n.e(8).then(n.bind(null,607))})),N=Object(a.lazy)((function(){return Promise.all([n.e(0),n.e(2),n.e(3),n.e(7),n.e(9)]).then(n.bind(null,613))})),z=Object(a.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(11)]).then(n.bind(null,608))})),W=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.setIsAuthenticated=function(t){e.setState({isAuthenticated:t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,isAuthenticated:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,setIsAuthenticated:e.setIsAuthenticated,list:[]},e.getUsers=function(){new m.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new m.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new m.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddDone=function(){e.getAllRounds()},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={};t.forEach((function(e,t){var o=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var s=t.get("objectId"),r=a[s];r||(r={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:0}),n>r.max&&(r.max=n),n<r.min&&(r.min=n),r.total=+new b.a(r.total).plus(n).valueOf(),r.totalBalance=+new b.a(r.totalBalance).plus(new b.a(n).times(o)).valueOf(),0!==n&&r.count++,a[s]=r}))}));var o=v.a.values(a);o.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:o})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,s=e.roundUserInfo,r=e.showSession,c=e.setUsers,l=e.setRounds,u=e.setRoundUserInfo,i=e.setShowSession,f=e.list,m=e.isAuthenticated,h=e.setIsAuthenticated,v=!Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).production;return o.a.createElement("div",{className:"app"},o.a.createElement(d.a.Provider,{value:{users:t,rounds:n,roundUserInfo:s,showSession:r,setUsers:c,setRounds:l,setRoundUserInfo:u,setShowSession:i,isAuthenticated:m,setIsAuthenticated:h}},o.a.createElement(R.a,null,m||v?o.a.createElement(C,null):null,o.a.createElement(a.Suspense,{fallback:o.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement(_.a,null))},o.a.createElement(A.d,null,o.a.createElement(T,{path:"/photo"},o.a.createElement(z,null)),o.a.createElement(T,{path:"/message"},o.a.createElement(P,null)),o.a.createElement(T,{path:"/profile"},o.a.createElement(D,null)),o.a.createElement(A.b,{path:"/auth"},o.a.createElement(x,null)),o.a.createElement(T,{path:"/"},o.a.createElement(N,{list:f,onAddDone:this.handleAddDone})))))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=n(235),L=n(13);m.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(L.a,{locale:B.a},o.a.createElement(W,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[240,5,6]]]);
//# sourceMappingURL=main.86891e1c.chunk.js.map