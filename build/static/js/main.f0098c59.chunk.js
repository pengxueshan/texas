(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{288:function(e,t,n){e.exports=n(592)},293:function(e,t,n){},294:function(e,t,n){},296:function(e,t,n){},297:function(e,t,n){},301:function(e,t){},303:function(e,t){},335:function(e,t){},336:function(e,t){},579:function(e,t,n){},590:function(e,t,n){},592:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(5),c=n.n(o),s=(n(293),n(63)),l=n(90),u=n(287),i=n(146),f=(n(294),n(295),r.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){}})),d=n(12),m=n.n(d),v=n(252),g=n.n(v),b=n(148),p=n.n(b),E=(n(296),n(13)),h=n(598),O=n(596),j=n(597),y=n(26),w=(n(297),n(253));function k(e){var t=e.visible,n=Object(a.useState)(!1),o=Object(E.a)(n,2),c=o[0],s=o[1],l=Object(a.useState)(""),u=Object(E.a)(l,2),i=u[0],d=u[1],v=Object(a.useState)(""),g=Object(E.a)(v,2),b=g[0],p=g[1],k=Object(a.useState)(0),S=Object(E.a)(k,2),I=S[0],U=S[1],x=Object(a.useState)(""),C=Object(E.a)(x,2),N=C[0],R=C[1],M=Object(a.useContext)(f);function D(){I<=0||(U(I-1),setTimeout(D,1e3))}return r.a.createElement(O.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return i?b?N?"41b9df4a217bb3c10b1c339358111b0d"!==Object(w.MD5)(N).toString()?h.a.error("\u9080\u8bf7\u7801\u9519\u8bef"):(s(!0),void m.a.User.signUpOrlogInWithMobilePhone("+86".concat(i),b).then((function(e){s(!1),M.setShowSession(!1)}),(function(e){s(!1),h.a.error(e.message)}))):h.a.error("\u8bf7\u8f93\u5165\u9080\u8bf7\u7801"):h.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):h.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){M.setShowSession(!1)},confirmLoading:c},r.a.createElement("div",{className:"session"},r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:i,onChange:function(e){d(e.target.value)}})),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9a8c\u8bc1\u7801",value:b,onChange:function(e){p(e.target.value)}}),r.a.createElement(y.a,{disabled:I>0,onClick:function(){I>0||!i||m.a.Cloud.requestSmsCode("+86".concat(i)).then((function(){U(60),function(){if(I>0)return;D()}()}))}},I<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(I,"s"))),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9080\u8bf7\u7801",value:N,onChange:function(e){R(e.target.value)}}))))}var S=n(95);function I(){var e=Object(a.useContext)(f);var t=m.a.User.current();return r.a.createElement("div",{className:"top-bar"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(S.b,{to:"/"},"\u6392\u884c\u699c")),r.a.createElement("li",null,r.a.createElement(S.b,{to:"/photo"},"\u7cbe\u5f69\u77ac\u95f4")),r.a.createElement("li",null,r.a.createElement(S.b,{to:"/message"},"\u804a\u5929\u5ba4")))),r.a.createElement("div",{className:"user-section"},t?[r.a.createElement("span",{key:"user-name"},t.getUsername()),r.a.createElement("span",{key:"logout",className:"link-style",onClick:function(){O.a.confirm({title:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:function(){return m.a.User.logOut().then((function(){window.location.reload()}))}})}},"\u9000\u51fa\u767b\u5f55")]:r.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),r.a.createElement(k,{visible:e.showSession})))}var U=n(19),x=n(593);function C(e){var t=e.list,n=Object(a.useContext)(f),o=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max",sorter:function(e,t){return e.max-t.max}},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min",sorter:function(e,t){return e.min-t.min}},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total",sorter:function(e,t){return e.total-t.total}},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance",sorter:function(e,t){return e.totalBalance-t.totalBalance}},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return r.a.createElement("div",null,r.a.createElement(x.a,{dataSource:t,columns:o}))}var N=n(274),R=n(594),M=n(599),D=n(45),T=n.n(D);function Y(e){var t=e.isModify,n=void 0!==t&&t,o=e.roundIndex,c=void 0===o?0:o,s=e.visible,l=e.onOk,u=e.onCancel,i=Object(a.useContext)(f),d=i.rounds,v=i.roundUserInfo,g=Object(a.useState)([{roundNO:d.length+1}]),b=Object(E.a)(g,2),p=b[0],j=b[1],y=Object(a.useState)(""),w=Object(E.a)(y,2),k=w[0],S=w[1],I=Object(a.useState)(.1),U=Object(E.a)(I,2),C=U[0],D=U[1],Y=Object(a.useState)({}),A=Object(E.a)(Y,2),B=A[0],P=A[1];function z(e){S(e?e.format("YYYY/MM/DD"):"")}function Q(e){D(e||.1)}return Object(a.useEffect)((function(){if(n){var e=v[c],t=d[c],a={};e&&e.forEach((function(e){a[e.get("player").get("objectId")]=e.get("amount")})),j([{roundNO:c+1}]),D(t.get("leverage")),S(t.get("dateTime")),P(a)}}),[n,v,c,d]),r.a.createElement(O.a,{visible:s,onCancel:function(){u()},onOk:function(){if(n){var e=i.rounds[c],t=i.roundUserInfo[c],a=m.a.Object.createWithoutData("Round",e.get("objectId"));a.set("dateTime",k),a.set("leverage",C);var r=[];return Object.keys(B).forEach((function(e){var n,o=t.find((function(t){return t.get("player").get("objectId")===e}));if(o)n=o;else{var c=i.users.find((function(t){return t.get("objectId")===e}));(n=new(m.a.Object.extend("RoundUserInfo"))).set("round",a),n.set("player",c)}n.set("amount",B[e]),r.push(n)})),Promise.all([a.save(),m.a.Object.saveAll(r)]).then((function(){l&&l()})).catch((function(e){h.a.error(e.message)}))}var o=new(m.a.Object.extend("Round"));o.set("dateTime",k),o.set("leverage",C);var s=m.a.Object.extend("RoundUserInfo"),u=[];return Object.keys(B).forEach((function(e){var t=new s,n=i.users.find((function(t){return t.get("objectId")===e}));t.set("round",o),t.set("player",n),t.set("amount",B[e]),u.push(t)})),m.a.Object.saveAll(u).then((function(){l&&l()})).catch((function(e){h.a.error(e.message)}))},width:1200},r.a.createElement("div",{className:"add-round-wrap"},r.a.createElement(x.a,{dataSource:p,columns:[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return r.a.createElement("div",{style:{width:"150px"}},r.a.createElement(R.a,{onChange:z,format:"YYYY/MM/DD",value:T()(k,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return r.a.createElement(M.a,{onChange:Q,value:C})}}].concat(i.users.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(){return r.a.createElement(M.a,{onChange:function(t){return function(e,t){e=e?+e:0;var n=Object(N.a)({},B);n[t.get("objectId")]=e,P(n)}(t,e)},value:B[e.get("objectId")]})}}}))),pagination:!1,scroll:{x:!0}})))}function A(e){var t=e.visible,n=e.onModify,o=e.onOk,c=e.onCancel,s=Object(a.useContext)(f);var l=s.rounds;return r.a.createElement(O.a,{visible:t,onCancel:c,onOk:o,width:1200},r.a.createElement("div",{className:"details-round-wrap"},r.a.createElement(x.a,{dataSource:l,columns:function(){var e=[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}],t=s.users;return e=e.concat(t.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(t,n,a){return function(e,t){var n=s.roundUserInfo[t];if(n){var a=n.find((function(t){return t.get("player").get("objectId")===e}));return a&&a.get("amount")||""}return""}(e.get("objectId"),a)}}}))),m.a.User.current()&&(e=e.concat({title:"\u64cd\u4f5c",key:"opt",render:function(e,t,a){return r.a.createElement("div",{className:"details-opt"},r.a.createElement("span",{onClick:function(){return function(e){n(e)}(a)}},"\u4fee\u6539"))}})),e}(),pagination:!1,scroll:{x:!0}})))}function B(e){var t=e.onAddDone,n=e.list,o=Object(a.useState)(!1),c=Object(E.a)(o,2),s=c[0],l=c[1],u=Object(a.useState)(!1),i=Object(E.a)(u,2),f=i[0],d=i[1],v=Object(a.useState)(!1),g=Object(E.a)(v,2),b=g[0],p=g[1],h=Object(a.useState)(-1),O=Object(E.a)(h,2),j=O[0],w=O[1],k=m.a.User.current();return r.a.createElement("div",{className:"page home"},r.a.createElement(C,{list:n}),r.a.createElement("div",{className:"btn-wrap"},r.a.createElement(y.a,{type:"primary",onClick:function(){l(!0)}},"\u660e\u7ec6"),k?r.a.createElement(y.a,{type:"primary",onClick:function(){d(!1),p(!0)}},"\u589e\u52a0\u8bb0\u5f55"):null),r.a.createElement(Y,{visible:s,onOk:function(){l(!1),t()},onCancel:function(){l(!1)},isModify:f,roundIndex:j}),r.a.createElement(A,{visible:b,onOk:function(){p(!1)},onCancel:function(){p(!1)},onModify:function(e){w(e),d(!0),p(!1),l(!0)}}))}var P=n(595),z=n(272);n(579);function Q(){var e=Object(a.useState)([]),t=Object(E.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(!1),s=Object(E.a)(c,2),l=s[0],u=s[1];function i(){var e=new m.a.Query("GamePic");e.limit(5),e.skip(n.length),u(!0),e.find().then((function(e){o(n.concat(e)),u(!1)}))}return Object(a.useEffect)((function(){i()}),[]),r.a.createElement("div",{className:"page photo"},r.a.createElement("div",{className:"upload-wrap"},r.a.createElement(P.a,{beforeUpload:function(e,t){return t.forEach((function(e){var t=new m.a.File(e.name,e);t.metaData("type",0);var n=new(m.a.Object.extend("GamePic"));n.set("file",t),n.set("uploader",m.a.User.current()),n.save({keepFileName:!0}).then((function(){h.a.success("\u4e0a\u4f20\u6210\u529f"),i()}))})),!1},showUploadList:!1,multiple:!0},r.a.createElement(y.a,null,"\u4e0a\u4f20\u56fe\u7247"))),r.a.createElement("div",{className:"pics"},n.map((function(e){return r.a.createElement("img",{key:e.get("objectId"),src:e.get("file").get("url"),alt:""})}))),r.a.createElement("div",{className:"spin-wrap"},l?r.a.createElement(z.a,null):r.a.createElement("span",{className:"link-style",onClick:i},"\u52a0\u8f7d\u66f4\u591a")))}var L=n(112);n(590);function W(){var e=Object(a.useState)(),t=Object(E.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),s=Object(E.a)(c,2),l=s[0],u=s[1],i=Object(a.useState)([]),f=Object(E.a)(i,2),d=f[0],v=f[1],g=Object(a.useState)(!1),b=Object(E.a)(g,2),p=b[0],h=b[1],O=Object(a.useRef)(null);function w(){if(l){var e=new L.TextMessage(l);console.log("messgae:",e),n&&(n.send(e),k(e),u(""))}}function k(e){v(d.concat(e)),setTimeout((function(){var e=O.current;e&&e.scrollTo(0,e.scrollHeight)}),100)}return Object(a.useEffect)((function(){var e=m.a.User.current();e&&(h(!0),new L.Realtime({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",server:"https://xfklg0d6.lc-cn-n1-shared.com"}).createIMClient(e).then((function(e){e.getQuery().equalTo("tr",!0).find().then((function(t){var n,a;(n=e).on(L.Event.INVITED,(function(e,t){})),n.on(L.Event.MESSAGE,(function(e,t){console.log("\u6536\u5230\u65b0\u6d88\u606f\uff1a"+e),k(e)})),t.length<1?function(e){e.createChatRoom({name:"\u6df1\u6316\u6d1e\uff0c\u5e7f\u79ef\u7cae\uff0c\u4e0d\u79f0\u738b"}).then((function(e){o(e),h(!1)}))}(e):(a=t[0]).join().then((function(){o(a),h(!1)}))})).catch(console.error)})))}),[]),p?r.a.createElement("div",{className:"message-wrap"},r.a.createElement(z.a,{tip:"\u6b63\u5728\u52a0\u5165\u804a\u5929\u5ba4..."})):r.a.createElement("div",{className:"message-wrap"},r.a.createElement("div",{className:"messages",ref:O},d.map((function(e){return r.a.createElement("div",{className:"message-item",key:e.id},r.a.createElement("div",null,r.a.createElement("span",{className:"username"},e.from),r.a.createElement("span",{className:"message-time"},T()(e.timestamp).format("YYYY/MM/DD HH:mm:ss"))),r.a.createElement("div",{className:"message-content"},e.text))}))),r.a.createElement("div",{className:"send-wrap"},r.a.createElement(j.a,{value:l,onChange:function(e){u(e.target.value)},onPressEnter:function(e){u(e.currentTarget.value),w()}}),r.a.createElement(y.a,{size:"large",onClick:w},"\u53d1\u9001")))}var q=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,list:[]},e.getUsers=function(){new m.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new m.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new m.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddDone=function(){e.getAllRounds()},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={};t.forEach((function(e,t){var r=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var o=t.get("objectId"),c=a[o];c||(c={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:0}),n>c.max&&(c.max=n),n<c.min&&(c.min=n),c.total=+new p.a(c.total).plus(n).valueOf(),c.totalBalance=+new p.a(c.totalBalance).plus(new p.a(n).times(r)).valueOf(),0!==n&&c.count++,a[o]=c}))}));var r=g.a.values(a);r.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:r})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,o=e.showSession,c=e.setUsers,s=e.setRounds,l=e.setRoundUserInfo,u=e.setShowSession,i=e.list;return r.a.createElement("div",{className:"app"},r.a.createElement(f.Provider,{value:{users:t,rounds:n,roundUserInfo:a,showSession:o,setUsers:c,setRounds:s,setRoundUserInfo:l,setShowSession:u}},r.a.createElement(S.a,null,r.a.createElement(I,null),r.a.createElement(U.c,null,r.a.createElement(U.a,{path:"/photo"},r.a.createElement(Q,null)),r.a.createElement(U.a,{path:"/message"},r.a.createElement(W,null)),r.a.createElement(U.a,{path:"/"},r.a.createElement(B,{list:i,onAddDone:this.handleAddDone}))))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var G=n(284),H=n(9);m.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(H.a,{locale:G.a},r.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[288,1,2]]]);
//# sourceMappingURL=main.f0098c59.chunk.js.map