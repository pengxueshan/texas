(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{272:function(e,t,n){e.exports=n(563)},277:function(e,t,n){},429:function(e,t,n){},453:function(e,t,n){},454:function(e,t,n){},458:function(e,t){},460:function(e,t){},492:function(e,t){},493:function(e,t){},563:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(5),s=n.n(r),i=(n(277),n(58)),c=n(84),l=n(271),u=n(135);function d(){return o.a.createElement("div",{className:"app-header"},o.a.createElement("h1",null,"\u4e00\u58f6\u79d1\u6280\u5fb7\u5dde\u5927\u8d5b\u6392\u884c\u699c"))}var f=n(564),m=o.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){}});function h(e){var t=e.list,n=Object(a.useContext)(m),r=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max"},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min"},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total"},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance"},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return o.a.createElement("div",null,o.a.createElement(f.a,{dataSource:t,columns:r}))}n(429),n(430);var v=n(13),g=n.n(v),b=n(24),p=n(251),y=n(26),w=n(568),O=n(565),j=n(569),I=n(566),S=n(53),k=n.n(S);function E(e){var t=e.isModify,n=void 0!==t&&t,r=e.roundIndex,s=void 0===r?0:r,i=e.visible,c=e.onOk,l=e.onCancel,u=Object(a.useContext)(m),d=u.rounds,h=u.roundUserInfo,v=Object(a.useState)([{roundNO:d.length+1}]),b=Object(y.a)(v,2),S=b[0],E=b[1],C=Object(a.useState)(""),M=Object(y.a)(C,2),U=M[0],x=M[1],R=Object(a.useState)(.1),D=Object(y.a)(R,2),N=D[0],Y=D[1],T=Object(a.useState)({}),B=Object(y.a)(T,2),A=B[0],L=B[1];function P(e){x(e?e.format("YYYY/MM/DD"):"")}function W(e){Y(e||.1)}return Object(a.useEffect)((function(){if(n){var e=h[s],t=d[s],a={};e&&e.forEach((function(e){a[e.get("player").get("objectId")]=e.get("amount")})),E([{roundNO:s+1}]),Y(t.get("leverage")),x(t.get("dateTime")),L(a)}}),[n,h,s,d]),o.a.createElement(I.a,{visible:i,onCancel:function(){l()},onOk:function(){if(n){var e=u.rounds[s],t=u.roundUserInfo[s],a=g.a.Object.createWithoutData("Round",e.get("objectId"));a.set("dateTime",U),a.set("leverage",N);var o=[];return Object.keys(A).forEach((function(e){var n,r=t.find((function(t){return t.get("player").get("objectId")===e}));if(r)n=r;else{var s=u.users.find((function(t){return t.get("objectId")===e}));(n=new(g.a.Object.extend("RoundUserInfo"))).set("round",a),n.set("player",s)}n.set("amount",A[e]),o.push(n)})),Promise.all([a.save(),g.a.Object.saveAll(o)]).then((function(){c&&c()})).catch((function(e){w.a.error(e.message)}))}var r=new(g.a.Object.extend("Round"));r.set("dateTime",U),r.set("leverage",N);var i=g.a.Object.extend("RoundUserInfo"),l=[];return Object.keys(A).forEach((function(e){var t=new i,n=u.users.find((function(t){return t.get("objectId")===e}));t.set("round",r),t.set("player",n),t.set("amount",A[e]),l.push(t)})),g.a.Object.saveAll(l).then((function(){c&&c()})).catch((function(e){w.a.error(e.message)}))},width:1200},o.a.createElement("div",{className:"add-round-wrap"},o.a.createElement(f.a,{dataSource:S,columns:[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return o.a.createElement("div",{style:{width:"150px"}},o.a.createElement(O.a,{onChange:P,format:"YYYY/MM/DD",value:k()(U,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return o.a.createElement(j.a,{onChange:W,value:N})}}].concat(u.users.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(){return o.a.createElement(j.a,{onChange:function(t){return function(e,t){e=e?+e:0;var n=Object(p.a)({},A);n[t.get("objectId")]=e,L(n)}(t,e)},value:A[e.get("objectId")]})}}}))),pagination:!1,scroll:{x:!0}})))}function C(e){var t=e.visible,n=e.onModify,r=e.onOk,s=e.onCancel,i=Object(a.useContext)(m);var c=i.rounds;return o.a.createElement(I.a,{visible:t,onCancel:s,onOk:r,width:1200},o.a.createElement("div",{className:"details-round-wrap"},o.a.createElement(f.a,{dataSource:c,columns:function(){var e=[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}],t=i.users;return e=e.concat(t.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(t,n,a){return function(e,t){var n=i.roundUserInfo[t];if(n){var a=n.find((function(t){return t.get("player").get("objectId")===e}));return a&&a.get("amount")||""}return""}(e.get("objectId"),a)}}}))),g.a.User.current()&&(e=e.concat({title:"\u64cd\u4f5c",key:"opt",render:function(e,t,a){return o.a.createElement("div",{className:"details-opt"},o.a.createElement("span",{onClick:function(){return function(e){n(e)}(a)}},"\u4fee\u6539"))}})),e}(),pagination:!1,scroll:{x:!0}})))}var M=n(262),U=n.n(M),x=n(137),R=n.n(x),D=(n(453),n(567)),N=(n(454),n(263));function Y(e){var t=e.visible,n=Object(a.useState)(!1),r=Object(y.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(""),l=Object(y.a)(c,2),u=l[0],d=l[1],f=Object(a.useState)(""),h=Object(y.a)(f,2),v=h[0],p=h[1],O=Object(a.useState)(0),j=Object(y.a)(O,2),S=j[0],k=j[1],E=Object(a.useState)(""),C=Object(y.a)(E,2),M=C[0],U=C[1],x=Object(a.useContext)(m);function R(){S<=0||(k(S-1),setTimeout(R,1e3))}return o.a.createElement(I.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return u?v?M?"41b9df4a217bb3c10b1c339358111b0d"!==Object(N.MD5)(M).toString()?w.a.error("\u9080\u8bf7\u7801\u9519\u8bef"):(i(!0),void g.a.User.signUpOrlogInWithMobilePhone("+86".concat(u),v).then((function(e){i(!1),x.setShowSession(!1)}),(function(e){i(!1),w.a.error(e.message)}))):w.a.error("\u8bf7\u8f93\u5165\u9080\u8bf7\u7801"):w.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):w.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){x.setShowSession(!1)},confirmLoading:s},o.a.createElement("div",{className:"session"},o.a.createElement("div",{className:"form-row"},o.a.createElement(D.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:u,onChange:function(e){d(e.target.value)}})),o.a.createElement("div",{className:"form-row"},o.a.createElement(D.a,{placeholder:"\u9a8c\u8bc1\u7801",value:v,onChange:function(e){p(e.target.value)}}),o.a.createElement(b.a,{disabled:S>0,onClick:function(){S>0||!u||g.a.Cloud.requestSmsCode("+86".concat(u)).then((function(){k(60),function(){if(S>0)return;R()}()}))}},S<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(S,"s"))),o.a.createElement("div",{className:"form-row"},o.a.createElement(D.a,{placeholder:"\u9080\u8bf7\u7801",value:M,onChange:function(e){U(e.target.value)}}))))}function T(){var e=Object(a.useContext)(m);var t=g.a.User.current();return o.a.createElement("div",{className:"top-bar"},t?[o.a.createElement("span",null,t.getUsername()),o.a.createElement("span",{className:"link-style",onClick:function(){I.a.confirm({title:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:function(){return g.a.User.logOut().then((function(){window.location.reload()}))}})}},"\u9000\u51fa\u767b\u5f55")]:o.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),o.a.createElement(Y,{visible:e.showSession}))}var B=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,list:[],showModal:!1,addLoading:!1,showDetailsModal:!1,modifyIndex:-1,isModify:!1},e.getUsers=function(){new g.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new g.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new g.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddClick=function(){e.setState({showModal:!0,isModify:!1})},e.handleDetailsClick=function(){e.setState({showDetailsModal:!0})},e.handleModalCancel=function(){e.setState({showModal:!1})},e.handleModalConfirm=function(){e.setState({showModal:!1}),e.getAllRounds()},e.handleDetailsConfirm=function(){e.setState({showDetailsModal:!1})},e.handleDetailsCancel=function(){e.setState({showDetailsModal:!1})},e.handleModify=function(t){e.setState({modifyIndex:t,isModify:!0,showDetailsModal:!1,showModal:!0})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={},o=n[n.length-1],r=0;o&&(r=o.get("leverage")),t.forEach((function(e,t){var o=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var s=t.get("objectId"),i=a[s];i||(i={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:r}),n>i.max&&(i.max=n),n<i.min&&(i.min=n),i.total=+new R.a(i.total).plus(n).valueOf(),i.totalBalance=+new R.a(i.totalBalance).plus(new R.a(n).times(o)).valueOf(),0!==n&&i.count++,a[s]=i}))}));var s=U.a.values(a);s.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:s})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,r=e.showSession,s=e.setUsers,i=e.setRounds,c=e.setRoundUserInfo,l=e.setShowSession,u=e.list,f=g.a.User.current();return o.a.createElement("div",{className:"app"},o.a.createElement(m.Provider,{value:{users:t,rounds:n,roundUserInfo:a,showSession:r,setUsers:s,setRounds:i,setRoundUserInfo:c,setShowSession:l}},o.a.createElement(T,null),o.a.createElement(d,null),o.a.createElement(h,{list:u}),o.a.createElement("div",{className:"btn-wrap"},o.a.createElement(b.a,{type:"primary",onClick:this.handleDetailsClick},"\u660e\u7ec6"),f?o.a.createElement(b.a,{type:"primary",onClick:this.handleAddClick},"\u589e\u52a0\u8bb0\u5f55"):null),o.a.createElement(E,{visible:this.state.showModal,onOk:this.handleModalConfirm,onCancel:this.handleModalCancel,isModify:this.state.isModify,roundIndex:this.state.modifyIndex}),o.a.createElement(C,{visible:this.state.showDetailsModal,onOk:this.handleDetailsConfirm,onCancel:this.handleDetailsCancel,onModify:this.handleModify})))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=n(268),L=n(10);g.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(L.a,{locale:A.a},o.a.createElement(B,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[272,1,2]]]);
//# sourceMappingURL=main.4b8473a5.chunk.js.map