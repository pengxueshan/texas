(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{287:function(e,t,n){e.exports=n(590)},292:function(e,t,n){},293:function(e,t,n){},295:function(e,t,n){},296:function(e,t,n){},300:function(e,t){},302:function(e,t){},334:function(e,t){},335:function(e,t){},578:function(e,t,n){},590:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(5),c=n.n(o),s=(n(292),n(62)),i=n(90),u=n(286),l=n(145),d=(n(293),n(294),r.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){}})),f=n(12),m=n.n(f),v=n(251),b=n.n(v),g=n(147),p=n.n(g),h=(n(295),n(17)),E=n(596),O=n(594),j=n(595),y=n(26),k=(n(296),n(252));function w(e){var t=e.visible,n=Object(a.useState)(!1),o=Object(h.a)(n,2),c=o[0],s=o[1],i=Object(a.useState)(""),u=Object(h.a)(i,2),l=u[0],f=u[1],v=Object(a.useState)(""),b=Object(h.a)(v,2),g=b[0],p=b[1],w=Object(a.useState)(0),S=Object(h.a)(w,2),I=S[0],U=S[1],x=Object(a.useState)(""),C=Object(h.a)(x,2),R=C[0],N=C[1],M=Object(a.useContext)(d);function D(){I<=0||(U(I-1),setTimeout(D,1e3))}return r.a.createElement(O.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return l?g?R?"41b9df4a217bb3c10b1c339358111b0d"!==Object(k.MD5)(R).toString()?E.a.error("\u9080\u8bf7\u7801\u9519\u8bef"):(s(!0),void m.a.User.signUpOrlogInWithMobilePhone("+86".concat(l),g).then((function(e){s(!1),M.setShowSession(!1)}),(function(e){s(!1),E.a.error(e.message)}))):E.a.error("\u8bf7\u8f93\u5165\u9080\u8bf7\u7801"):E.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):E.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){M.setShowSession(!1)},confirmLoading:c},r.a.createElement("div",{className:"session"},r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:l,onChange:function(e){f(e.target.value)}})),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9a8c\u8bc1\u7801",value:g,onChange:function(e){p(e.target.value)}}),r.a.createElement(y.a,{disabled:I>0,onClick:function(){I>0||!l||m.a.Cloud.requestSmsCode("+86".concat(l)).then((function(){U(60),function(){if(I>0)return;D()}()}))}},I<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(I,"s"))),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9080\u8bf7\u7801",value:R,onChange:function(e){N(e.target.value)}}))))}var S=n(111);function I(){var e=Object(a.useContext)(d);var t=m.a.User.current();return r.a.createElement("div",{className:"top-bar"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(S.b,{to:"/"},"\u6392\u884c\u699c")),r.a.createElement("li",null,r.a.createElement(S.b,{to:"/photo"},"\u7cbe\u5f69\u77ac\u95f4")))),r.a.createElement("div",{className:"user-section"},t?[r.a.createElement("span",{key:"user-name"},t.getUsername()),r.a.createElement("span",{key:"logout",className:"link-style",onClick:function(){O.a.confirm({title:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:function(){return m.a.User.logOut().then((function(){window.location.reload()}))}})}},"\u9000\u51fa\u767b\u5f55")]:r.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),r.a.createElement(w,{visible:e.showSession})))}var U=n(19),x=n(591);function C(e){var t=e.list,n=Object(a.useContext)(d),o=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max"},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min"},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total"},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance"},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return r.a.createElement("div",null,r.a.createElement(x.a,{dataSource:t,columns:o}))}var R=n(273),N=n(592),M=n(597),D=n(57),Y=n.n(D);function A(e){var t=e.isModify,n=void 0!==t&&t,o=e.roundIndex,c=void 0===o?0:o,s=e.visible,i=e.onOk,u=e.onCancel,l=Object(a.useContext)(d),f=l.rounds,v=l.roundUserInfo,b=Object(a.useState)([{roundNO:f.length+1}]),g=Object(h.a)(b,2),p=g[0],j=g[1],y=Object(a.useState)(""),k=Object(h.a)(y,2),w=k[0],S=k[1],I=Object(a.useState)(.1),U=Object(h.a)(I,2),C=U[0],D=U[1],A=Object(a.useState)({}),T=Object(h.a)(A,2),B=T[0],L=T[1];function P(e){S(e?e.format("YYYY/MM/DD"):"")}function Q(e){D(e||.1)}return Object(a.useEffect)((function(){if(n){var e=v[c],t=f[c],a={};e&&e.forEach((function(e){a[e.get("player").get("objectId")]=e.get("amount")})),j([{roundNO:c+1}]),D(t.get("leverage")),S(t.get("dateTime")),L(a)}}),[n,v,c,f]),r.a.createElement(O.a,{visible:s,onCancel:function(){u()},onOk:function(){if(n){var e=l.rounds[c],t=l.roundUserInfo[c],a=m.a.Object.createWithoutData("Round",e.get("objectId"));a.set("dateTime",w),a.set("leverage",C);var r=[];return Object.keys(B).forEach((function(e){var n,o=t.find((function(t){return t.get("player").get("objectId")===e}));if(o)n=o;else{var c=l.users.find((function(t){return t.get("objectId")===e}));(n=new(m.a.Object.extend("RoundUserInfo"))).set("round",a),n.set("player",c)}n.set("amount",B[e]),r.push(n)})),Promise.all([a.save(),m.a.Object.saveAll(r)]).then((function(){i&&i()})).catch((function(e){E.a.error(e.message)}))}var o=new(m.a.Object.extend("Round"));o.set("dateTime",w),o.set("leverage",C);var s=m.a.Object.extend("RoundUserInfo"),u=[];return Object.keys(B).forEach((function(e){var t=new s,n=l.users.find((function(t){return t.get("objectId")===e}));t.set("round",o),t.set("player",n),t.set("amount",B[e]),u.push(t)})),m.a.Object.saveAll(u).then((function(){i&&i()})).catch((function(e){E.a.error(e.message)}))},width:1200},r.a.createElement("div",{className:"add-round-wrap"},r.a.createElement(x.a,{dataSource:p,columns:[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return r.a.createElement("div",{style:{width:"150px"}},r.a.createElement(N.a,{onChange:P,format:"YYYY/MM/DD",value:Y()(w,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return r.a.createElement(M.a,{onChange:Q,value:C})}}].concat(l.users.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(){return r.a.createElement(M.a,{onChange:function(t){return function(e,t){e=e?+e:0;var n=Object(R.a)({},B);n[t.get("objectId")]=e,L(n)}(t,e)},value:B[e.get("objectId")]})}}}))),pagination:!1,scroll:{x:!0}})))}function T(e){var t=e.visible,n=e.onModify,o=e.onOk,c=e.onCancel,s=Object(a.useContext)(d);var i=s.rounds;return r.a.createElement(O.a,{visible:t,onCancel:c,onOk:o,width:1200},r.a.createElement("div",{className:"details-round-wrap"},r.a.createElement(x.a,{dataSource:i,columns:function(){var e=[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}],t=s.users;return e=e.concat(t.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(t,n,a){return function(e,t){var n=s.roundUserInfo[t];if(n){var a=n.find((function(t){return t.get("player").get("objectId")===e}));return a&&a.get("amount")||""}return""}(e.get("objectId"),a)}}}))),m.a.User.current()&&(e=e.concat({title:"\u64cd\u4f5c",key:"opt",render:function(e,t,a){return r.a.createElement("div",{className:"details-opt"},r.a.createElement("span",{onClick:function(){return function(e){n(e)}(a)}},"\u4fee\u6539"))}})),e}(),pagination:!1,scroll:{x:!0}})))}function B(e){var t=e.onAddDone,n=e.list,o=Object(a.useState)(!1),c=Object(h.a)(o,2),s=c[0],i=c[1],u=Object(a.useState)(!1),l=Object(h.a)(u,2),d=l[0],f=l[1],v=Object(a.useState)(!1),b=Object(h.a)(v,2),g=b[0],p=b[1],E=Object(a.useState)(-1),O=Object(h.a)(E,2),j=O[0],k=O[1],w=m.a.User.current();return r.a.createElement("div",{className:"page home"},r.a.createElement(C,{list:n}),r.a.createElement("div",{className:"btn-wrap"},r.a.createElement(y.a,{type:"primary",onClick:function(){i(!0)}},"\u660e\u7ec6"),w?r.a.createElement(y.a,{type:"primary",onClick:function(){f(!1),p(!0)}},"\u589e\u52a0\u8bb0\u5f55"):null),r.a.createElement(A,{visible:s,onOk:function(){i(!1),t()},onCancel:function(){i(!1)},isModify:d,roundIndex:j}),r.a.createElement(T,{visible:g,onOk:function(){p(!1)},onCancel:function(){p(!1)},onModify:function(e){k(e),f(!0),p(!1),i(!0)}}))}var L=n(593),P=n(271);n(578);function Q(){var e=Object(a.useState)([]),t=Object(h.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(!1),s=Object(h.a)(c,2),i=s[0],u=s[1];function l(){var e=new m.a.Query("GamePic");e.limit(5),e.skip(n.length),u(!0),e.find().then((function(e){o(n.concat(e)),u(!1)}))}return Object(a.useEffect)((function(){l()}),[]),r.a.createElement("div",{className:"page photo"},r.a.createElement("div",{className:"upload-wrap"},r.a.createElement(L.a,{beforeUpload:function(e,t){return t.forEach((function(e){var t=new m.a.File(e.name,e);t.metaData("type",0);var n=new(m.a.Object.extend("GamePic"));n.set("file",t),n.set("uploader",m.a.User.current()),n.save({keepFileName:!0}).then((function(){E.a.success("\u4e0a\u4f20\u6210\u529f"),l()}))})),!1},showUploadList:!1,multiple:!0},r.a.createElement(y.a,null,"\u4e0a\u4f20\u56fe\u7247"))),r.a.createElement("div",{className:"pics"},n.map((function(e){return r.a.createElement("img",{key:e.get("objectId"),src:e.get("file").get("url"),alt:""})}))),r.a.createElement("div",{className:"spin-wrap"},i?r.a.createElement(P.a,null):r.a.createElement("span",{className:"link-style",onClick:l},"\u52a0\u8f7d\u66f4\u591a")))}var W=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,list:[]},e.getUsers=function(){new m.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new m.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new m.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddDone=function(){e.getAllRounds()},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={};t.forEach((function(e,t){var r=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var o=t.get("objectId"),c=a[o];c||(c={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:0}),n>c.max&&(c.max=n),n<c.min&&(c.min=n),c.total=+new p.a(c.total).plus(n).valueOf(),c.totalBalance=+new p.a(c.totalBalance).plus(new p.a(n).times(r)).valueOf(),0!==n&&c.count++,a[o]=c}))}));var r=b.a.values(a);r.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:r})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,o=e.showSession,c=e.setUsers,s=e.setRounds,i=e.setRoundUserInfo,u=e.setShowSession,l=e.list;return r.a.createElement("div",{className:"app"},r.a.createElement(d.Provider,{value:{users:t,rounds:n,roundUserInfo:a,showSession:o,setUsers:c,setRounds:s,setRoundUserInfo:i,setShowSession:u}},r.a.createElement(S.a,null,r.a.createElement(I,null),r.a.createElement(U.c,null,r.a.createElement(U.a,{path:"/photo"},r.a.createElement(Q,null)),r.a.createElement(U.a,{path:"/"},r.a.createElement(B,{list:l,onAddDone:this.handleAddDone}))))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=n(283),z=n(9);m.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(z.a,{locale:q.a},r.a.createElement(W,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[287,1,2]]]);
//# sourceMappingURL=main.983dd6ce.chunk.js.map