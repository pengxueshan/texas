(this.webpackJsonptexas=this.webpackJsonptexas||[]).push([[0],{288:function(e,t,n){e.exports=n(592)},293:function(e,t,n){},294:function(e,t,n){},296:function(e,t,n){},297:function(e,t,n){},301:function(e,t){},303:function(e,t){},335:function(e,t){},336:function(e,t){},579:function(e,t,n){},590:function(e,t,n){},592:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(5),o=n.n(s),c=(n(293),n(49)),i=n(64),l=n(147),u=n(95),m=(n(294),n(295),r.a.createContext({users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:function(){},setRounds:function(){},setRoundUserInfo:function(){},setShowSession:function(){}})),d=n(12),f=n.n(d),v=n(253),g=n.n(v),h=n(149),p=n.n(h),b=(n(296),n(17)),E=n(598),O=n(596),j=n(597),y=n(26),S=(n(297),n(254));function k(e){var t=e.visible,n=Object(a.useState)(!1),s=Object(b.a)(n,2),o=s[0],c=s[1],i=Object(a.useState)(""),l=Object(b.a)(i,2),u=l[0],d=l[1],v=Object(a.useState)(""),g=Object(b.a)(v,2),h=g[0],p=g[1],k=Object(a.useState)(0),w=Object(b.a)(k,2),I=w[0],x=w[1],U=Object(a.useState)(""),N=Object(b.a)(U,2),C=N[0],M=N[1],R=Object(a.useContext)(m);function T(){I<=0||(x(I-1),setTimeout(T,1e3))}return r.a.createElement(O.a,{title:"\u767b\u5f55\u6216\u6ce8\u518c",visible:t,onOk:function(){return u?h?C?"41b9df4a217bb3c10b1c339358111b0d"!==Object(S.MD5)(C).toString()?E.a.error("\u9080\u8bf7\u7801\u9519\u8bef"):(c(!0),void f.a.User.signUpOrlogInWithMobilePhone("+86".concat(u),h).then((function(e){c(!1),R.setShowSession(!1)}),(function(e){c(!1),E.a.error(e.message)}))):E.a.error("\u8bf7\u8f93\u5165\u9080\u8bf7\u7801"):E.a.error("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"):E.a.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")},onCancel:function(){R.setShowSession(!1)},confirmLoading:o},r.a.createElement("div",{className:"session"},r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u624b\u673a\u53f7\u7801",value:u,onChange:function(e){d(e.target.value)}})),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9a8c\u8bc1\u7801",value:h,onChange:function(e){p(e.target.value)}}),r.a.createElement(y.a,{disabled:I>0,onClick:function(){I>0||!u||f.a.Cloud.requestSmsCode("+86".concat(u)).then((function(){x(60),function(){if(I>0)return;T()}()}))}},I<=0?"\u83b7\u53d6\u9a8c\u8bc1\u7801":"".concat(I,"s"))),r.a.createElement("div",{className:"form-row"},r.a.createElement(j.a,{placeholder:"\u9080\u8bf7\u7801",value:C,onChange:function(e){M(e.target.value)}}))))}var w=n(96);function I(){var e=Object(a.useContext)(m);var t=f.a.User.current();return r.a.createElement("div",{className:"top-bar"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(w.b,{to:"/"},"\u6392\u884c\u699c")),r.a.createElement("li",null,r.a.createElement(w.b,{to:"/photo"},"\u7cbe\u5f69\u77ac\u95f4")),r.a.createElement("li",null,r.a.createElement(w.b,{to:"/message"},"\u804a\u5929\u5ba4")))),r.a.createElement("div",{className:"user-section"},t?[r.a.createElement("span",{key:"user-name"},t.getUsername()),r.a.createElement("span",{key:"logout",className:"link-style",onClick:function(){O.a.confirm({title:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:function(){return f.a.User.logOut().then((function(){window.location.reload()}))}})}},"\u9000\u51fa\u767b\u5f55")]:r.a.createElement("span",{className:"link-style",onClick:function(){e.setShowSession(!0)}},"\u767b\u5f55"),r.a.createElement(k,{visible:e.showSession})))}var x=n(19),U=n(593);function N(e){var t=e.list,n=Object(a.useContext)(m),s=[{title:"\u6392\u540d",key:"rank",render:function(e,t,n){return n+1}},{title:"\u9009\u624b",key:"username",render:function(e,t){return function(e){var t=n.users.find((function(t){return t.get("objectId")===e}));if(t)return t.get("name");return""}(t.player.get("objectId"))}},{title:"\u53c2\u8d5b\u6b21\u6570",key:"count",dataIndex:"count"},{title:"\u5355\u6b21\u6700\u5927\u76c8\u5229",key:"max",dataIndex:"max",sorter:function(e,t){return e.max-t.max}},{title:"\u5355\u6b21\u6700\u5927\u4e8f\u635f",key:"min",dataIndex:"min",sorter:function(e,t){return e.min-t.min}},{title:"\u7d2f\u8ba1\u7b79\u7801\u76c8\u4e8f",key:"total",dataIndex:"total",sorter:function(e,t){return e.total-t.total}},{title:"\u7d2f\u8ba1\u76c8\u4e8f\u91d1\u989d",key:"totalBalance",dataIndex:"totalBalance",sorter:function(e,t){return e.totalBalance-t.totalBalance}},{title:"\u5f53\u524d\u8d54\u7387",key:"currentLeverage",dataIndex:"currentLeverage"},{title:"\u64cd\u4f5c",key:"opt",dataIndex:"opt"}];return r.a.createElement("div",null,r.a.createElement(U.a,{dataSource:t,columns:s,pagination:!1}))}var C=n(275),M=n(594),R=n(599),T=n(45),D=n.n(T);function L(e){var t=e.isModify,n=void 0!==t&&t,s=e.roundIndex,o=void 0===s?0:s,c=e.visible,i=e.onOk,l=e.onCancel,u=Object(a.useContext)(m),d=u.rounds,v=u.roundUserInfo,g=Object(a.useState)([{roundNO:d.length+1}]),h=Object(b.a)(g,2),p=h[0],j=h[1],y=Object(a.useState)(""),S=Object(b.a)(y,2),k=S[0],w=S[1],I=Object(a.useState)(.1),x=Object(b.a)(I,2),N=x[0],T=x[1],L=Object(a.useState)({}),Y=Object(b.a)(L,2),A=Y[0],B=Y[1];function P(e){w(e?e.format("YYYY/MM/DD"):"")}function z(e){T(e||.1)}return Object(a.useEffect)((function(){if(n){var e=v[o],t=d[o],a={};e&&e.forEach((function(e){a[e.get("player").get("objectId")]=e.get("amount")})),j([{roundNO:o+1}]),T(t.get("leverage")),w(t.get("dateTime")),B(a)}}),[n,v,o,d]),r.a.createElement(O.a,{visible:c,onCancel:function(){l()},onOk:function(){if(n){var e=u.rounds[o],t=u.roundUserInfo[o],a=f.a.Object.createWithoutData("Round",e.get("objectId"));a.set("dateTime",k),a.set("leverage",N);var r=[];return Object.keys(A).forEach((function(e){var n,s=t.find((function(t){return t.get("player").get("objectId")===e}));if(s)n=s;else{var o=u.users.find((function(t){return t.get("objectId")===e}));(n=new(f.a.Object.extend("RoundUserInfo"))).set("round",a),n.set("player",o)}n.set("amount",A[e]),r.push(n)})),Promise.all([a.save(),f.a.Object.saveAll(r)]).then((function(){i&&i()})).catch((function(e){E.a.error(e.message)}))}var s=new(f.a.Object.extend("Round"));s.set("dateTime",k),s.set("leverage",N);var c=f.a.Object.extend("RoundUserInfo"),l=[];return Object.keys(A).forEach((function(e){var t=new c,n=u.users.find((function(t){return t.get("objectId")===e}));t.set("round",s),t.set("player",n),t.set("amount",A[e]),l.push(t)})),f.a.Object.saveAll(l).then((function(){i&&i()})).catch((function(e){E.a.error(e.message)}))},width:1200},r.a.createElement("div",{className:"add-round-wrap"},r.a.createElement(U.a,{dataSource:p,columns:[{title:"\u573a\u6b21",key:"roundNO",dataIndex:"roundNO",ellipsis:!0},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(){return r.a.createElement("div",{style:{width:"150px"}},r.a.createElement(M.a,{onChange:P,format:"YYYY/MM/DD",value:D()(k,"YYYY/MM/DD")}))}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(){return r.a.createElement(R.a,{onChange:z,value:N})}}].concat(u.users.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(){return r.a.createElement(R.a,{onChange:function(t){return function(e,t){e=e?+e:0;var n=Object(C.a)({},A);n[t.get("objectId")]=e,B(n)}(t,e)},value:A[e.get("objectId")]})}}}))),pagination:!1,scroll:{x:!0}})))}function Y(e){var t=e.visible,n=e.onModify,s=e.onOk,o=e.onCancel,c=Object(a.useContext)(m);var i=c.rounds;return r.a.createElement(O.a,{visible:t,onCancel:o,onOk:s,width:1200},r.a.createElement("div",{className:"details-round-wrap"},r.a.createElement(U.a,{dataSource:i,columns:function(){var e=[{title:"\u573a\u6b21",key:"roundNO",ellipsis:!0,render:function(e,t,n){return n+1}},{title:"\u65e5\u671f",key:"dateTime",ellipsis:!0,render:function(e,t){return t.get("dateTime")}},{title:"\u6760\u6746\u6bd4\u4f8b",key:"leverage",ellipsis:!0,render:function(e,t){return t.get("leverage")}}],t=c.users;return e=e.concat(t.map((function(e){return{title:e.get("name"),key:e.get("objectId"),ellipsis:!0,render:function(t,n,a){return function(e,t){var n=c.roundUserInfo[t];if(n){var a=n.find((function(t){return t.get("player").get("objectId")===e}));return a&&a.get("amount")||""}return""}(e.get("objectId"),a)}}}))),f.a.User.current()&&(e=e.concat({title:"\u64cd\u4f5c",key:"opt",render:function(e,t,a){return r.a.createElement("div",{className:"details-opt"},r.a.createElement("span",{onClick:function(){return function(e){n(e)}(a)}},"\u4fee\u6539"))}})),e}(),pagination:!1,scroll:{x:!0}})))}function A(e){var t=e.onAddDone,n=e.list,s=Object(a.useState)(!1),o=Object(b.a)(s,2),c=o[0],i=o[1],l=Object(a.useState)(!1),u=Object(b.a)(l,2),m=u[0],d=u[1],v=Object(a.useState)(!1),g=Object(b.a)(v,2),h=g[0],p=g[1],E=Object(a.useState)(-1),O=Object(b.a)(E,2),j=O[0],S=O[1],k=f.a.User.current();return r.a.createElement("div",{className:"page home"},r.a.createElement(N,{list:n}),r.a.createElement("div",{className:"btn-wrap"},r.a.createElement(y.a,{type:"primary",onClick:function(){i(!0)}},"\u660e\u7ec6"),k?r.a.createElement(y.a,{type:"primary",onClick:function(){d(!1),p(!0)}},"\u589e\u52a0\u8bb0\u5f55"):null),r.a.createElement(L,{visible:c,onOk:function(){i(!1),t()},onCancel:function(){i(!1)},isModify:m,roundIndex:j}),r.a.createElement(Y,{visible:h,onOk:function(){p(!1)},onCancel:function(){p(!1)},onModify:function(e){S(e),d(!0),p(!1),i(!0)}}))}var B=n(595),P=n(273);n(579);function z(){var e=Object(a.useState)([]),t=Object(b.a)(e,2),n=t[0],s=t[1],o=Object(a.useState)(!1),c=Object(b.a)(o,2),i=c[0],l=c[1];function u(){var e=new f.a.Query("GamePic");e.limit(5),e.skip(n.length),l(!0),e.find().then((function(e){s(n.concat(e)),l(!1)}))}return Object(a.useEffect)((function(){u()}),[]),r.a.createElement("div",{className:"page photo"},r.a.createElement("div",{className:"upload-wrap"},r.a.createElement(B.a,{beforeUpload:function(e,t){return t.forEach((function(e){var t=new f.a.File(e.name,e);t.metaData("type",0);var n=new(f.a.Object.extend("GamePic"));n.set("file",t),n.set("uploader",f.a.User.current()),n.save({keepFileName:!0}).then((function(){E.a.success("\u4e0a\u4f20\u6210\u529f"),u()}))})),!1},showUploadList:!1,multiple:!0},r.a.createElement(y.a,null,"\u4e0a\u4f20\u56fe\u7247"))),r.a.createElement("div",{className:"pics"},n.map((function(e){return r.a.createElement("img",{key:e.get("objectId"),src:e.get("file").get("url"),alt:""})}))),r.a.createElement("div",{className:"spin-wrap"},i?r.a.createElement(P.a,null):r.a.createElement("span",{className:"link-style",onClick:u},"\u52a0\u8f7d\u66f4\u591a")))}var Q=n(113),J=(n(590),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={text:"",messageList:[],isJoining:!1},e.client=null,e.room=null,e.scrollRef=Object(a.createRef)(),e.user=f.a.User.current(),e.handleTextMessageChange=function(t){e.setState({text:t.target.value})},e.handleTextMessageEnterChange=function(t){e.setState({text:t.currentTarget.value}),e.handleSend()},e.handleSend=function(){if(e.state.text){var t=new Q.TextMessage(e.state.text);t.setAttributes({senderName:e.user.getUsername()}),e.room&&(e.room.send(t),e.updateMessageList(t),e.setState({text:""}))}},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.user&&new Q.Realtime({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",server:"https://xfklg0d6.lc-cn-n1-shared.com"}).createIMClient(this.user).then((function(t){e.client=t,t.getQuery().equalTo("tr",!0).find().then((function(t){t.length<1?e.createRoom():e.joinRoom(t[0])})).then((function(){e.listenMessage()})).catch(console.error)}))}},{key:"createRoom",value:function(){var e=this;this.client&&this.client.createChatRoom({name:"\u6df1\u6316\u6d1e\uff0c\u5e7f\u79ef\u7cae\uff0c\u4e0d\u79f0\u738b"}).then((function(t){e.room=t,e.setState({isJoining:!1}),e.loadLocalMessages()}))}},{key:"loadLocalMessages",value:function(){var e=localStorage.getItem("texasMessages");e&&(e=JSON.parse(e),this.setState({messageList:e}))}},{key:"joinRoom",value:function(e){var t=this;e.join().then((function(){t.room=e,t.setState({isJoining:!1}),t.loadLocalMessages()}))}},{key:"listenMessage",value:function(){var e=this;this.client&&(this.client.on(Q.Event.INVITED,(function(e,t){})),this.client.on(Q.Event.MESSAGE,(function(t,n){e.updateMessageList(t)})))}},{key:"updateMessageList",value:function(e){var t=this;this.setState({messageList:this.state.messageList.concat(e)},(function(){localStorage.setItem("texasMessages",JSON.stringify(t.state.messageList.slice(0,100)))})),setTimeout((function(){var e=t.scrollRef.current;e&&e.scrollTo(0,e.scrollHeight)}),100)}},{key:"getSenderName",value:function(e){return e.attributes.senderName}},{key:"render",value:function(){var e=this;return this.user?this.state.isJoining?r.a.createElement("div",{className:"message-wrap"},r.a.createElement(P.a,{tip:"\u6b63\u5728\u52a0\u5165\u804a\u5929\u5ba4..."})):r.a.createElement("div",{className:"message-wrap"},r.a.createElement("div",{className:"messages",ref:this.scrollRef},this.state.messageList.map((function(t){return r.a.createElement("div",{className:"message-item",key:t.id},r.a.createElement("div",null,r.a.createElement("span",{className:"username"},e.getSenderName(t)),r.a.createElement("span",{className:"message-time"},D()(t.timestamp).format("YYYY/MM/DD HH:mm:ss"))),r.a.createElement("div",{className:"message-content"},t.text))}))),r.a.createElement("div",{className:"send-wrap"},r.a.createElement(j.a,{value:this.state.text,onChange:this.handleTextMessageChange,onPressEnter:this.handleTextMessageEnterChange}),r.a.createElement(y.a,{size:"large",onClick:this.handleSend},"\u53d1\u9001"))):r.a.createElement("div",{className:"message-wrap"},r.a.createElement("div",null,"\u8bf7\u5148\u767b\u5f55"))}}]),n}(a.Component)),W=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).setUsers=function(t){e.setState({users:t})},e.setRounds=function(t){e.setState({rounds:t})},e.setRoundUserInfo=function(t){e.setState({roundUserInfo:t},e.calcList)},e.setShowSession=function(t){e.setState({showSession:!!t})},e.state={users:[],rounds:[],roundUserInfo:[],showSession:!1,setUsers:e.setUsers,setRounds:e.setRounds,setRoundUserInfo:e.setRoundUserInfo,setShowSession:e.setShowSession,list:[]},e.getUsers=function(){new f.a.Query("Player").find().then((function(t){e.setUsers(t)}))},e.getAllRounds=function(){new f.a.Query("Round").find().then((function(t){Promise.all(t.map((function(t){return e.getRoundInfo(t)}))).then((function(n){e.setRounds(t),e.setRoundUserInfo(n)}))}))},e.getRoundInfo=function(e){var t=new f.a.Query("RoundUserInfo");return t.equalTo("round",e),t.find()},e.handleAddDone=function(){e.getAllRounds()},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.getUsers(),this.getAllRounds()}},{key:"calcList",value:function(){var e=this.state,t=e.roundUserInfo,n=e.rounds,a={};t.forEach((function(e,t){var r=n[t].get("leverage");e.forEach((function(e){var t=e.get("player"),n=e.get("amount");n=+n;var s=t.get("objectId"),o=a[s];o||(o={max:0,min:0,total:0,totalBalance:0,count:0,player:t,currentLeverage:0}),n>o.max&&(o.max=n),n<o.min&&(o.min=n),o.total=+new p.a(o.total).plus(n).valueOf(),o.totalBalance=+new p.a(o.totalBalance).plus(new p.a(n).times(r)).valueOf(),0!==n&&o.count++,a[s]=o}))}));var r=g.a.values(a);r.sort((function(e,t){return t.totalBalance-e.totalBalance})),this.setState({list:r})}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.rounds,a=e.roundUserInfo,s=e.showSession,o=e.setUsers,c=e.setRounds,i=e.setRoundUserInfo,l=e.setShowSession,u=e.list;return r.a.createElement("div",{className:"app"},r.a.createElement(m.Provider,{value:{users:t,rounds:n,roundUserInfo:a,showSession:s,setUsers:o,setRounds:c,setRoundUserInfo:i,setShowSession:l}},r.a.createElement(w.a,null,r.a.createElement(I,null),r.a.createElement(x.c,null,r.a.createElement(x.a,{path:"/photo"},r.a.createElement(z,null)),r.a.createElement(x.a,{path:"/message"},r.a.createElement(J,null)),r.a.createElement(x.a,{path:"/"},r.a.createElement(A,{list:u,onAddDone:this.handleAddDone}))))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=n(285),G=n(9);f.a.init({appId:"xfKlG0D6VO6MgwOUTzQ31f7W-gzGzoHsz",appKey:"k9TuwPqFQmsMqj3HYa83WCFs",serverURL:"https://xfklg0d6.lc-cn-n1-shared.com"}),o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G.a,{locale:q.a},r.a.createElement(W,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[288,1,2]]]);
//# sourceMappingURL=main.08a77f06.chunk.js.map